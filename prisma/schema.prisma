generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                @id @default(dbgenerated("(gen_random_uuid())::text"))
  email                String                @unique
  name                 String?
  role                 UserRole
  suspended            Boolean               @default(false)
  suspensionReason     String?
  createdAt            DateTime?             @default(now()) @db.Timestamptz(6)
  updatedAt            DateTime?             @default(now()) @updatedAt @db.Timestamptz(6)
  supabaseId           String?               @unique
  bandProfile          BandProfile[]
  djProfile            DJProfile?
  receivedMessages     Message[]             @relation("MessageReceiver")
  sentMessages         Message[]             @relation("MessageSender")
  otherCreativeProfile OtherCreativeProfile?
  photographerProfile  PhotographerProfile?
  reviews              reviews[]
  triviaHostProfile    TriviaHostProfile?
  venueProfiles        VenueProfile[]

  @@index([email])
  @@index([supabaseId], map: "users_supabaseid_idx")
  @@map("users")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model BandProfile {
  id             String             @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId         String
  bandName       String
  bio            String?
  genre          String[]
  location       String?
  website        String?
  spotifyUrl     String?
  youtubeUrl     String?
  instagramUrl   String?
  facebookUrl    String?
  photos         String[]
  audioSamples   String[]
  techRider      String?
  minFee         Int?
  maxFee         Int?
  createdAt      DateTime?          @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?          @default(now()) @updatedAt @db.Timestamptz(6)
  slug           String?
  applications   Application[]
  availableDates BandAvailability[]
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "band_profiles_userid_fkey")
  reviews        reviews[]

  @@index([userId], map: "band_profiles_userid_idx")
  @@map("band_profiles")
}

model BandAvailability {
  id            String      @id @default(dbgenerated("(gen_random_uuid())::text"))
  bandProfileId String
  startDate     DateTime    @db.Date
  endDate       DateTime    @db.Date
  notes         String?
  createdAt     DateTime?   @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?   @default(now()) @updatedAt @db.Timestamptz(6)
  bandProfile   BandProfile @relation(fields: [bandProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "band_availability_bandprofileid_fkey")

  @@map("band_availability")
}

model VenueProfile {
  id            String      @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId        String      @default("0640e98b-92da-4bb3-8721-031ad6b58b76")
  venueName     String
  description   String?
  address       String?
  city          String?
  state         String?
  zipCode       String?
  capacity      Int?
  stageSize     String?
  genrePrefs    String[]
  hasSound      Boolean?    @default(false)
  hasLighting   Boolean?    @default(false)
  hasParking    Boolean?    @default(false)
  phone         String?
  website       String?
  bookingEmail  String?
  payoutType    String?
  payoutDetails String?
  photos        String[]
  createdAt     DateTime?   @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?   @default(now()) @updatedAt @db.Timestamptz(6)
  reviews       reviews[]
  venueSlots    VenueSlot[]
  users         User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId], map: "venue_profiles_userid_idx")
  @@map("venue_profiles")
}

model VenueSlot {
  id             String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  venueProfileId String
  eventDate      DateTime      @db.Date
  startTime      DateTime?     @db.Timestamptz(6)
  endTime        DateTime?     @db.Timestamptz(6)
  eventTitle     String?
  description    String?
  genrePrefs     String[]
  status         SlotStatus?   @default(AVAILABLE)
  createdAt      DateTime?     @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?     @default(now()) @updatedAt @db.Timestamptz(6)
  talentTypes    String[]      @default(["BAND"])
  applications   Application[]
  venueProfile   VenueProfile  @relation(fields: [venueProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "venue_slots_venueprofileid_fkey")

  @@map("venue_slots")
}

model Application {
  id                      String                @id @default(dbgenerated("(gen_random_uuid())::text"))
  bandProfileId           String?
  venueSlotId             String
  status                  ApplicationStatus?    @default(PENDING)
  message                 String?
  proposedFee             Int?
  createdAt               DateTime?             @default(now()) @db.Timestamptz(6)
  updatedAt               DateTime?             @default(now()) @updatedAt @db.Timestamptz(6)
  triviaHostProfileId     String?
  djProfileId             String?
  photographerProfileId   String?
  otherCreativeProfileId  String?
  bandProfile             BandProfile?          @relation(fields: [bandProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_bandprofileid_fkey")
  dj_profiles             DJProfile?            @relation(fields: [djProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_djprofileid_fkey")
  other_creative_profiles OtherCreativeProfile? @relation(fields: [otherCreativeProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_othercreativeprofileid_fkey")
  photographer_profiles   PhotographerProfile?  @relation(fields: [photographerProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_photographerprofileid_fkey")
  trivia_host_profiles    TriviaHostProfile?    @relation(fields: [triviaHostProfileId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_triviahostprofileid_fkey")
  venueSlot               VenueSlot             @relation(fields: [venueSlotId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "applications_venueslotid_fkey")
  messages                Message[]

  @@map("applications")
}

model Message {
  id            String       @id @default(dbgenerated("(gen_random_uuid())::text"))
  senderId      String
  receiverId    String
  applicationId String?
  content       String
  createdAt     DateTime?    @default(now()) @db.Timestamptz(6)
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "messages_applicationid_fkey")
  receiver      User         @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "messages_receiverid_fkey")
  sender        User         @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "messages_senderid_fkey")

  @@map("messages")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reviews {
  id              String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  reviewer_id     String?
  band_profile_id String?
  venue_id        String?
  rating          Int           @db.SmallInt
  body            String?
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime      @default(now()) @db.Timestamptz(6)
  deleted_at      DateTime?     @db.Timestamptz(6)
  is_flagged      Boolean       @default(false)
  moderator_notes String?
  band_profiles   BandProfile?  @relation(fields: [band_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           User?         @relation(fields: [reviewer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  venue_profiles  VenueProfile? @relation(fields: [venue_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model TriviaHostProfile {
  id             String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId         String        @unique
  hostName       String
  bio            String?
  specialization String?
  experience     String?
  photos         String[]
  website        String?
  phone          String?
  location       String?
  rates          Int?
  createdAt      DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime      @default(now()) @updatedAt @db.Timestamptz(6)
  slug           String?
  applications   Application[]
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "trivia_host_profiles_userid_fkey")

  @@index([userId], map: "trivia_host_profiles_userid_idx")
  @@map("trivia_host_profiles")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model DJProfile {
  id             String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId         String        @unique
  djName         String
  bio            String?
  specialization String[]
  experience     String?
  photos         String[]
  website        String?
  mixCloudUrl    String?
  spotifyUrl     String?
  soundCloudUrl  String?
  instagramUrl   String?
  phone          String?
  location       String?
  minFee         Int?
  maxFee         Int?
  equipment      String?
  createdAt      DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime      @default(now()) @updatedAt @db.Timestamptz(6)
  slug           String?
  applications   Application[]
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "dj_profiles_userid_fkey")

  @@index([userId], map: "dj_profiles_userid_idx")
  @@map("dj_profiles")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model PhotographerProfile {
  id               String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId           String        @unique
  photographerName String
  bio              String?
  specialization   String[]
  experience       String?
  portfolioPhotos  String[]
  website          String?
  instagramUrl     String?
  phone            String?
  location         String?
  rates            Int?
  createdAt        DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime      @default(now()) @updatedAt @db.Timestamptz(6)
  slug             String?
  applications     Application[]
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "photographer_profiles_userid_fkey")

  @@index([userId], map: "photographer_profiles_userid_idx")
  @@map("photographer_profiles")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model OtherCreativeProfile {
  id             String        @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId         String        @unique
  creativeName   String
  bio            String?
  creativeType   String?
  specialization String?
  experience     String?
  portfolio      String[]
  website        String?
  phone          String?
  location       String?
  rates          Int?
  createdAt      DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime      @default(now()) @updatedAt @db.Timestamptz(6)
  slug           String?
  applications   Application[]
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "other_creative_profiles_userid_fkey")

  @@index([userId], map: "other_creative_profiles_userid_idx")
  @@map("other_creative_profiles")
}

enum UserRole {
  BAND
  VENUE
  ADMIN
  DJ
  TRIVIA_HOST
  PHOTOGRAPHER
  OTHER_CREATIVE
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum SlotStatus {
  AVAILABLE
  BOOKED
  CANCELLED
}
